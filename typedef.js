#! node

const { typedef } = require('./index');
const { docopt } = require('docopt');
const fs = require('fs');
const path = require('path');

const help = `
typedef - a utility for generating jsdoc @typedef comments from json objects

Usage:
  typedef --name=<name> [options]

Options:
  -h --help                         Show this screen
  -n --name <name>                  The name of the Type
  -f --file <file>                  Read from a file instead of STDIN
  -o --output <output>              Output to a file instead of STDOUT
  -d --description <description>    A description of the the type
`

function run() {
  const options = docopt(help);
  const description = options['--description'] || 'Generated by @shawnrushefsky/typedef';

  let filepath = options['--file'] || 0;
  const payload = JSON.parse(fs.readFileSync(filepath, 'utf8'));
  let comment = typedef(options['--name'], description, payload);


  if (!options['--output']) {
    console.log(comment);
  } else {
    fs.writeFileSync(path.resolve(options['--output']), comment);
  }
}

run();